# Unified Video Factory æ‰§è¡Œè®¡åˆ’

> åŸºäº UNIFIED_ARCHITECTURE.md çš„è¯¦ç»†å®æ–½è·¯çº¿å›¾

---

## ç°çŠ¶åˆ†æ

| æ¨¡å— | çŠ¶æ€ | å®Œæˆåº¦ |
|------|------|--------|
| **Learning Mode** (åŸ Hardcore Player) | âœ… ç”Ÿäº§å¯ç”¨ | 95% |
| **Watching Mode** (SceneMind) | âœ… Phase 1A å®Œæˆ | 90% |
| **Dubbing Mode** | âœ… Phase 2 å®Œæˆ | 100% |
| **å¡ç‰‡ç³»ç»Ÿ** | âœ… Phase 1B å®Œæˆ | 100% |
| **é€æ˜å­—å¹•æ¸²æŸ“** | âœ… Phase 1C å®Œæˆ | 100% |
| **è®°å¿†æœ¬** | âœ… Phase 1D å®Œæˆ | 100% |

---

## æ‰§è¡Œé¡ºåº

```
                    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                    â”‚   Phase 0: ç»Ÿä¸€åŸºç¡€è®¾æ–½ (å¿…é¡»)    â”‚
                    â”‚   Job.mode + Timeline æ‰©å±•       â”‚
                    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                      â”‚
              â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
              â–¼                       â–¼                       â–¼
    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚  Phase 1A       â”‚     â”‚  Phase 1B       â”‚     â”‚  Phase 2        â”‚
    â”‚  åˆå¹¶ SceneMind â”‚     â”‚  å¡ç‰‡ç³»ç»Ÿ        â”‚     â”‚  é…éŸ³æ¨¡å¼       â”‚
    â”‚  (ä¸­ä¼˜å…ˆçº§)      â”‚     â”‚  (é«˜ä¼˜å…ˆçº§)      â”‚     â”‚  (ä½ä¼˜å…ˆçº§)     â”‚
    â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”˜     â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”˜     â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”˜
             â”‚                       â”‚                       â”‚
             â–¼                       â–¼                       â”‚
    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”              â”‚
    â”‚  Phase 1C       â”‚     â”‚  Phase 1D       â”‚              â”‚
    â”‚  é€æ˜å­—å¹•æ¸²æŸ“    â”‚     â”‚  è®°å¿†æœ¬ + Anki  â”‚              â”‚
    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜     â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜              â”‚
                                                             â–¼
                                                   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                                                   â”‚  Phase 3        â”‚
                                                   â”‚  å£å‹åŒæ­¥ (å¯é€‰) â”‚
                                                   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

**æ¨èæ‰§è¡Œé¡ºåº**: `0 â†’ 1B â†’ 1A â†’ 1C â†’ 1D â†’ 2 â†’ 3`

**ç†ç”±**:
1. **å¡ç‰‡ç³»ç»Ÿ (1B)** æ˜¯ä¸‰ç§æ¨¡å¼çš„å…±äº«åŠŸèƒ½ï¼ŒROI æœ€é«˜
2. **SceneMind åˆå¹¶ (1A)** ç›¸å¯¹ç®€å•ï¼Œä¸”å·²æœ‰ä»£ç 
3. **é…éŸ³æ¨¡å¼ (2)** æŠ€æœ¯å¤æ‚åº¦é«˜ï¼Œå¯å»¶å

---

## Phase 0: ç»Ÿä¸€åŸºç¡€è®¾æ–½

> **ç›®æ ‡**: ä¸ºä¸‰ç§æ¨¡å¼æä¾›ç»Ÿä¸€çš„æ•°æ®æ¨¡å‹åŸºç¡€
> **é¢„ä¼°å·¥æ—¶**: 6.5h
> **ä¼˜å…ˆçº§**: ğŸ”´ å¿…é¡»

### ä»»åŠ¡åˆ—è¡¨

| ID | ä»»åŠ¡ | æ–‡ä»¶ | å·¥æ—¶ | çŠ¶æ€ |
|----|------|------|------|------|
| 0.1 | æ·»åŠ  `JobMode` æšä¸¾ | `backend/app/models/job.py` | 0.5h | âœ… |
| 0.2 | æ·»åŠ æ¨¡å¼é…ç½®ç±» `LearningConfig/WatchingConfig/DubbingConfig` | `backend/app/models/job.py` | 1h | âœ… |
| 0.3 | Job æ¨¡å‹æ·»åŠ  `mode` å’Œ `config` å­—æ®µ | `backend/app/models/job.py` | 0.5h | âœ… |
| 0.4 | Timeline æ¨¡å‹æ·»åŠ  `mode` å­—æ®µ | `backend/app/models/timeline.py` | 0.5h | âœ… |
| 0.5 | æ›´æ–° Job API æ”¯æŒ `mode` å‚æ•° | `backend/app/api/jobs.py` | 1h | âœ… |
| 0.6 | æ›´æ–°å‰ç«¯åˆ›å»º Job æ—¶é€‰æ‹©æ¨¡å¼ | `frontend/src/app/jobs/page.tsx` | 2h | âœ… |
| 0.7 | è¿ç§»è„šæœ¬: ç°æœ‰æ•°æ®æ ‡è®°ä¸º LEARNING | `scripts/migrate_to_unified.py` | 1h | âœ… |

### éªŒæ”¶æ ‡å‡†

- [x] åˆ›å»º Job æ—¶å¯é€‰ mode (é»˜è®¤ LEARNING)
- [x] ç°æœ‰åŠŸèƒ½æ— å›å½’ (30 tests passed)
- [x] æ•°æ®è¿ç§»è„šæœ¬å¯é‡å¤æ‰§è¡Œ

### ä»£ç ç¤ºä¾‹

```python
# backend/app/models/job.py

class JobMode(str, Enum):
    """è§†é¢‘å¤„ç†æ¨¡å¼"""
    LEARNING = "learning"    # å­¦ä¹ æ¨¡å¼: åŸéŸ³ + åŒè¯­å­—å¹•
    WATCHING = "watching"    # è§‚å½±æ¨¡å¼: åŸéŸ³ + é€æ˜å­—å¹• + æˆªå›¾
    DUBBING = "dubbing"      # é…éŸ³æ¨¡å¼: å…‹éš†é…éŸ³ + å£å‹åŒæ­¥

class LearningConfig(BaseModel):
    """å­¦ä¹ æ¨¡å¼é…ç½®"""
    subtitle_style: str = "half_screen"
    generate_cards: bool = True
    card_types: List[str] = ["word", "entity"]

class WatchingConfig(BaseModel):
    """è§‚å½±æ¨¡å¼é…ç½®"""
    subtitle_style: str = "floating"
    enable_observations: bool = True

class DubbingConfig(BaseModel):
    """é…éŸ³æ¨¡å¼é…ç½®"""
    voice_clone: bool = True
    voice_model: str = "xtts_v2"
    lip_sync: bool = False
    keep_bgm: bool = True

class Job(BaseModel):
    # ... existing fields ...
    mode: JobMode = JobMode.LEARNING
    learning_config: Optional[LearningConfig] = None
    watching_config: Optional[WatchingConfig] = None
    dubbing_config: Optional[DubbingConfig] = None
```

---

## Phase 1B: å¡ç‰‡ç³»ç»Ÿ

> **ç›®æ ‡**: å®ç°å¯ç‚¹å‡»å­—å¹• + å•è¯/å®ä½“å¡ç‰‡å¼¹çª—
> **é¢„ä¼°å·¥æ—¶**: 40h
> **ä¼˜å…ˆçº§**: ğŸ”´ é«˜

### 1B.1 åç«¯ - NER Worker

| ID | ä»»åŠ¡ | æ–‡ä»¶ | å·¥æ—¶ | çŠ¶æ€ |
|----|------|------|------|------|
| 1B.1.1 | åˆ›å»º NERWorker åŸºç¡€ç»“æ„ | `backend/app/workers/ner.py` | 1h | âœ… |
| 1B.1.2 | é›†æˆ spaCy æˆ– OpenAI NER | `backend/app/workers/ner.py` | 2h | âœ… |
| 1B.1.3 | æå–å•è¯ (ç”Ÿè¯æ£€æµ‹é€»è¾‘) | `backend/app/workers/ner.py` | 2h | âœ… |
| 1B.1.4 | æå–å®ä½“ (äººå/åœ°å/ç»„ç»‡/æ¦‚å¿µ) | `backend/app/workers/ner.py` | 2h | âœ… |
| 1B.1.5 | è¾“å‡ºæ ¼å¼: segment çº§åˆ«æ ‡æ³¨ | `backend/app/workers/ner.py` | 1h | âœ… |

### 1B.2 åç«¯ - Card Generator Worker

| ID | ä»»åŠ¡ | æ–‡ä»¶ | å·¥æ—¶ | çŠ¶æ€ |
|----|------|------|------|------|
| 1B.2.1 | åˆ›å»º CardGeneratorWorker | `backend/app/workers/card_generator.py` | 1h | âœ… |
| 1B.2.2 | è¯å…¸ API é›†æˆ (WordsAPI/Free Dictionary) | `backend/app/workers/card_generator.py` | 3h | âœ… |
| 1B.2.3 | Wikidata API é›†æˆ (å®ä½“ä¿¡æ¯) | `backend/app/workers/card_generator.py` | 3h | âœ… |
| 1B.2.4 | å¡ç‰‡ç¼“å­˜æœºåˆ¶ (é¿å…é‡å¤æŸ¥è¯¢) | `backend/app/services/card_cache.py` | 2h | âœ… |
| 1B.2.5 | WordCard æ¨¡å‹ | `backend/app/models/card.py` | 1h | âœ… |
| 1B.2.6 | EntityCard æ¨¡å‹ | `backend/app/models/card.py` | 1h | âœ… |

### 1B.3 åç«¯ - API ç«¯ç‚¹

| ID | ä»»åŠ¡ | æ–‡ä»¶ | å·¥æ—¶ | çŠ¶æ€ |
|----|------|------|------|------|
| 1B.3.1 | `GET /cards/words/{word}` | `backend/app/api/cards.py` | 1h | âœ… |
| 1B.3.2 | `GET /cards/entities/{entity_id}` | `backend/app/api/cards.py` | 1h | âœ… |
| 1B.3.3 | `GET /cards/entities/search/{query}` | `backend/app/api/cards.py` | 1h | âœ… |
| 1B.3.4 | `POST /cards/timelines/{id}/generate` | `backend/app/api/cards.py` | 1h | âœ… |

### 1B.4 å‰ç«¯ - å¯ç‚¹å‡»å­—å¹•

| ID | ä»»åŠ¡ | æ–‡ä»¶ | å·¥æ—¶ | çŠ¶æ€ |
|----|------|------|------|------|
| 1B.4.1 | ClickableSubtitle ç»„ä»¶ | `frontend/src/components/Cards/ClickableSubtitle.tsx` | 3h | âœ… |
| 1B.4.2 | å­—å¹•æ–‡æœ¬è§£æ (å•è¯è¾¹ç•Œæ£€æµ‹) | (é›†æˆåœ¨ ClickableSubtitle ä¸­) | 2h | âœ… |
| 1B.4.3 | ç‚¹å‡»äº‹ä»¶å¤„ç† + å¡ç‰‡é¢„åŠ è½½ | `frontend/src/hooks/useCardPopup.ts` | 2h | âœ… |

### 1B.5 å‰ç«¯ - å¡ç‰‡å¼¹çª—

| ID | ä»»åŠ¡ | æ–‡ä»¶ | å·¥æ—¶ | çŠ¶æ€ |
|----|------|------|------|------|
| 1B.5.1 | WordCard å¼¹çª—ç»„ä»¶ | `frontend/src/components/Cards/WordCard.tsx` | 4h | âœ… |
| 1B.5.2 | EntityCard å¼¹çª—ç»„ä»¶ | `frontend/src/components/Cards/EntityCard.tsx` | 4h | âœ… |
| 1B.5.3 | CardPopupContainer (ä½ç½®è®¡ç®—) | `frontend/src/components/Cards/CardPopupContainer.tsx` | 2h | âœ… |
| 1B.5.4 | å¡ç‰‡ç¼“å­˜ Hook | `frontend/src/hooks/useCardPopup.ts` | 2h | âœ… |
| 1B.5.5 | é›†æˆåˆ° SegmentList ç»„ä»¶ | `frontend/src/components/SegmentList.tsx` | 2h | âœ… |

### éªŒæ”¶æ ‡å‡†

- [x] å­—å¹•ä¸­å•è¯å¯ç‚¹å‡»
- [x] ç‚¹å‡»åæ˜¾ç¤ºå¡ç‰‡å¼¹çª— (å‘éŸ³ã€è¯ä¹‰ã€ä¾‹å¥ã€å›¾ç‰‡)
- [x] å®ä½“å¯ç‚¹å‡»æ˜¾ç¤ºç»´åŸºç™¾ç§‘æ‘˜è¦
- [x] å¡ç‰‡æ•°æ®æœ‰ç¼“å­˜ï¼Œé¿å…é‡å¤ API è°ƒç”¨

### æ•°æ®æ¨¡å‹

```python
# backend/app/models/card.py

class Pronunciation(BaseModel):
    ipa: str
    audio_url: Optional[str] = None

class WordSense(BaseModel):
    part_of_speech: str      # noun, verb, adj, etc.
    definition: str
    examples: List[str] = []
    synonyms: List[str] = []

class WordCard(BaseModel):
    word: str
    lemma: str                              # è¯æ ¹
    pronunciations: List[Pronunciation]
    senses: List[WordSense]
    images: List[str] = []
    frequency_rank: Optional[int] = None    # è¯é¢‘æ’å

class EntityCard(BaseModel):
    entity_id: str                          # Wikidata QID (e.g., Q42)
    entity_type: str                        # person, place, organization, concept
    name: str
    description: str
    wikipedia_url: Optional[str] = None
    image_url: Optional[str] = None
    birth_date: Optional[str] = None        # for persons
    location: Optional[str] = None          # for places
```

---

## Phase 1A: åˆå¹¶ SceneMind

> **ç›®æ ‡**: å°† SceneMind è§‚å¯ŸåŠŸèƒ½æ•´åˆåˆ° Timeline ä¸­
> **é¢„ä¼°å·¥æ—¶**: 13h
> **ä¼˜å…ˆçº§**: ğŸŸ¡ ä¸­
> **çŠ¶æ€**: âœ… å·²å®Œæˆ (æ ¸å¿ƒåŠŸèƒ½)

### ä»»åŠ¡åˆ—è¡¨

| ID | ä»»åŠ¡ | æ–‡ä»¶ | å·¥æ—¶ | çŠ¶æ€ |
|----|------|------|------|------|
| 1A.1 | Timeline æ¨¡å‹æ·»åŠ  `observations` å­—æ®µ | `backend/app/models/timeline.py` | 1h | âœ… |
| 1A.2 | è¿ç§» Observation æ¨¡å‹åˆ° timeline æ¨¡å— | `backend/app/models/timeline.py` | 1h | âœ… |
| 1A.3 | TimelineManager æ·»åŠ  observation CRUD | `backend/app/services/timeline_manager.py` | 2h | âœ… |
| 1A.4 | åˆå¹¶ SceneMind API åˆ° Timeline API | `backend/app/api/timelines.py` | 2h | âœ… |
| 1A.5 | è¿ç§» FrameCaptureWorker åˆ°é€šç”¨ workers | `backend/app/workers/frame_capture.py` | 1h | âœ… |
| 1A.6 | å‰ç«¯: types + API å‡½æ•° | `frontend/src/lib/types.ts, api.ts` | 1h | âœ… |
| 1A.7 | å‰ç«¯: ObservationCapture + ObservationList | `frontend/src/app/review/[timelineId]/` | 3h | âœ… |
| 1A.8 | å‰ç«¯: ObservationMarkers æ—¶é—´è½´ç»„ä»¶ | `frontend/src/components/timeline/ObservationMarkers.tsx` | 2h | âœ… |
| 1A.9 | å‰ç«¯: Review é¡µé¢é›†æˆ | `frontend/src/app/review/[timelineId]/page.tsx` | 1h | âœ… |

### éªŒæ”¶æ ‡å‡†

- [x] WATCHING æ¨¡å¼ Timeline å¯æ·»åŠ  observations (API ready)
- [x] Review é¡µé¢æ”¯æŒæˆªå›¾åŠŸèƒ½ (å¿«æ·é”® S)
- [x] Observation åˆ—è¡¨æ˜¾ç¤ºåœ¨ä¾§è¾¹æ 
- [ ] æ—¶é—´è½´ä¸Šæ˜¾ç¤ºè§‚å¯Ÿç‚¹æ ‡è®° (ç»„ä»¶å·²åˆ›å»ºï¼Œå¾…é›†æˆåˆ° TimelineEditor)
- [ ] æ—§ SceneMind æ•°æ®å¯è¿ç§»

### API å˜æ›´

```
# åˆ é™¤ç‹¬ç«‹ SceneMind API
DELETE /scenemind/sessions
DELETE /scenemind/sessions/{id}/observations

# åˆå¹¶åˆ° Timeline API
POST   /timelines/{id}/observations           # æ·»åŠ è§‚å¯Ÿ (è‡ªåŠ¨æˆªå›¾)
GET    /timelines/{id}/observations           # è·å–è§‚å¯Ÿåˆ—è¡¨
DELETE /timelines/{id}/observations/{obs_id}  # åˆ é™¤è§‚å¯Ÿ
GET    /timelines/{id}/observations/{obs_id}/frame  # è·å–æˆªå›¾
```

---

## Phase 1C: é€æ˜å­—å¹•æ¸²æŸ“

> **ç›®æ ‡**: æ”¯æŒ WATCHING æ¨¡å¼çš„é€æ˜æ‚¬æµ®å­—å¹•æ ·å¼
> **é¢„ä¼°å·¥æ—¶**: 8.5h
> **ä¼˜å…ˆçº§**: ğŸŸ¡ ä¸­
> **çŠ¶æ€**: âœ… å·²å®Œæˆ

### ä»»åŠ¡åˆ—è¡¨

| ID | ä»»åŠ¡ | æ–‡ä»¶ | å·¥æ—¶ | çŠ¶æ€ |
|----|------|------|------|------|
| 1C.1 | å­—å¹•æ ·å¼æšä¸¾ `SubtitleStyleMode` | `backend/app/models/timeline.py` | 0.5h | âœ… |
| 1C.2 | ExportWorker æ”¯æŒé€æ˜å­—å¹•æ¸²æŸ“ | `backend/app/workers/export.py` | 4h | âœ… |
| 1C.3 | FFmpeg ASS æ ·å¼æ¨¡æ¿ (é€æ˜èƒŒæ™¯) | `backend/app/workers/subtitle_styles.py` | 2h | âœ… |
| 1C.4 | åç«¯: subtitle-style-mode API | `backend/app/api/timelines.py` | 0.5h | âœ… |
| 1C.5 | å‰ç«¯: types + API å‡½æ•° | `frontend/src/lib/types.ts, api.ts` | 1h | âœ… |
| 1C.6 | å‰ç«¯: å­—å¹•æ ·å¼é€‰æ‹©å™¨ UI | `frontend/src/components/ExportDialog.tsx` | 2h | â¬œ |

### éªŒæ”¶æ ‡å‡†

- [x] å¯¼å‡ºæ—¶å¯é€‰å­—å¹•æ ·å¼: `half_screen` (å­¦ä¹ ) / `floating` (è§‚å½±) / `none` (é…éŸ³)
- [x] é€æ˜å­—å¹•ä¸é®æŒ¡ç”»é¢ (floating æ¨¡å¼ä½¿ç”¨æ–‡å­—æè¾¹è€ŒéèƒŒæ™¯æ¡†)
- [x] API æ”¯æŒè®¾ç½®å’Œè·å–å­—å¹•æ ·å¼æ¨¡å¼
- [ ] å‰ç«¯ UI é€‰æ‹©å™¨ (å¯é€šè¿‡ API è°ƒç”¨ï¼ŒUI å¾…å®Œæˆ)

### å­—å¹•æ ·å¼å¯¹æ¯”

| æ ·å¼ | ä½ç½® | èƒŒæ™¯ | é€‚ç”¨æ¨¡å¼ |
|------|------|------|----------|
| `half_screen` | åº•éƒ¨ 1/3 | åŠé€æ˜é»‘è‰² | Learning |
| `floating` | åº•éƒ¨å±…ä¸­ | é€æ˜/è½»å¾®é˜´å½± | Watching |
| `none` | - | - | Dubbing (å¯é€‰) |

---

## Phase 1D: è®°å¿†æœ¬ + Anki å¯¼å‡º

> **ç›®æ ‡**: ç”¨æˆ·æ”¶è—å•è¯/å®ä½“ï¼Œå¯¼å‡º Anki å¡ç‰‡ç»„
> **é¢„ä¼°å·¥æ—¶**: 19h
> **ä¼˜å…ˆçº§**: ğŸŸ¡ ä¸­
> **çŠ¶æ€**: âœ… å·²å®Œæˆ

### ä»»åŠ¡åˆ—è¡¨

| ID | ä»»åŠ¡ | æ–‡ä»¶ | å·¥æ—¶ | çŠ¶æ€ |
|----|------|------|------|------|
| 1D.1 | MemoryBook æ¨¡å‹ | `backend/app/models/memory_book.py` | 1h | âœ… |
| 1D.2 | MemoryItem æ¨¡å‹ | `backend/app/models/memory_book.py` | 1h | âœ… |
| 1D.3 | MemoryBookManager æœåŠ¡ | `backend/app/services/memory_book_manager.py` | 3h | âœ… |
| 1D.4 | è®°å¿†æœ¬ API ç«¯ç‚¹ | `backend/app/api/memory_books.py` | 2h | âœ… |
| 1D.5 | Anki å¯¼å‡º Worker (genanki) | `backend/app/workers/anki_export.py` | 4h | âœ… |
| 1D.6 | å‰ç«¯: MemoryBookList | `frontend/src/components/MemoryBook/MemoryBookList.tsx` | 3h | âœ… |
| 1D.7 | å‰ç«¯: MemoryItemCard | `frontend/src/components/MemoryBook/MemoryItemCard.tsx` | 2h | âœ… |
| 1D.8 | å‰ç«¯: AnkiExportDialog | `frontend/src/components/MemoryBook/AnkiExportDialog.tsx` | 2h | âœ… |
| 1D.9 | å‰ç«¯: å¡ç‰‡å¼¹çª—æ·»åŠ  "æ”¶è—" æŒ‰é’® | `frontend/src/components/Cards/*.tsx` | 1h | âœ… |

### éªŒæ”¶æ ‡å‡†

- [x] ç‚¹å‡»å•è¯/å®ä½“å¡ç‰‡å¯æ”¶è—åˆ°è®°å¿†æœ¬
- [x] è®°å¿†æœ¬é¡µé¢å±•ç¤ºæ‰€æœ‰æ”¶è—
- [x] å¯å¯¼å‡º `.apkg` æ–‡ä»¶å¯¼å…¥ Anki
- [x] Anki å¡ç‰‡åŒ…å«: å•è¯ã€å‘éŸ³ã€é‡Šä¹‰ã€ä¾‹å¥ã€æ¥æºè§†é¢‘æˆªå›¾

### API ç«¯ç‚¹

```
GET    /memory-books                      # è·å–è®°å¿†æœ¬åˆ—è¡¨
POST   /memory-books                      # åˆ›å»ºè®°å¿†æœ¬
GET    /memory-books/{id}                 # è·å–è®°å¿†æœ¬è¯¦æƒ…
DELETE /memory-books/{id}                 # åˆ é™¤è®°å¿†æœ¬

GET    /memory-books/{id}/items           # è·å–è®°å¿†é¡¹åˆ—è¡¨
POST   /memory-books/{id}/items           # æ·»åŠ è®°å¿†é¡¹
DELETE /memory-books/{id}/items/{item_id} # åˆ é™¤è®°å¿†é¡¹

GET    /memory-books/{id}/export/anki     # å¯¼å‡º Anki å¡ç‰‡ç»„ (.apkg)
```

### æ•°æ®æ¨¡å‹

```python
# backend/app/models/memory_book.py

class MemoryBook(BaseModel):
    book_id: str
    name: str
    description: str = ""
    item_count: int = 0
    created_at: datetime
    updated_at: datetime

class MemoryItem(BaseModel):
    item_id: str
    book_id: str
    target_type: str                # "word" | "entity" | "observation"
    target_id: str                  # word string / entity QID / observation ID
    source_video_id: str            # Timeline ID
    source_timecode: float
    user_notes: str = ""
    tags: List[str] = []
    created_at: datetime
```

---

## Phase 2: é…éŸ³æ¨¡å¼

> **ç›®æ ‡**: å®ç°éŸ³è‰²å…‹éš† + èƒŒæ™¯éŸ³ä¿ç•™ + éŸ³è½¨æ··åˆ
> **é¢„ä¼°å·¥æ—¶**: 44h
> **ä¼˜å…ˆçº§**: ğŸŸ¢ ä½
> **çŠ¶æ€**: âœ… å·²å®Œæˆ

### 2.1 éŸ³é¢‘åˆ†ç¦» (Demucs)

| ID | ä»»åŠ¡ | æ–‡ä»¶ | å·¥æ—¶ | çŠ¶æ€ |
|----|------|------|------|------|
| 2.1.1 | Demucs ç¯å¢ƒé…ç½® | `requirements-dubbing.txt` | 1h | âœ… |
| 2.1.2 | AudioSeparationWorker | `backend/app/workers/audio_separation.py` | 4h | âœ… |
| 2.1.3 | è¾“å‡º: vocals/bgm/sfx åˆ†ç¦» | `backend/app/workers/audio_separation.py` | 2h | âœ… |

### 2.2 éŸ³è‰²å…‹éš† (XTTS v2)

| ID | ä»»åŠ¡ | æ–‡ä»¶ | å·¥æ—¶ | çŠ¶æ€ |
|----|------|------|------|------|
| 2.2.1 | XTTS v2 ç¯å¢ƒé…ç½® | `requirements-dubbing.txt` | 2h | âœ… |
| 2.2.2 | VoiceCloneWorker åŸºç¡€ | `backend/app/workers/voice_clone.py` | 3h | âœ… |
| 2.2.3 | è¯´è¯äººéŸ³è‰²æ ·æœ¬æå– | `backend/app/workers/voice_clone.py` | 2h | âœ… |
| 2.2.4 | æŒ‰è¯´è¯äººåˆ†åˆ«åˆæˆé…éŸ³ | `backend/app/workers/voice_clone.py` | 4h | âœ… |
| 2.2.5 | è¯­é€Ÿè°ƒæ•´ (æ—¶é•¿å¯¹é½) | `backend/app/workers/voice_clone.py` | 3h | âœ… |

### 2.3 éŸ³è½¨æ··åˆ

| ID | ä»»åŠ¡ | æ–‡ä»¶ | å·¥æ—¶ | çŠ¶æ€ |
|----|------|------|------|------|
| 2.3.1 | AudioMixerWorker | `backend/app/workers/audio_mixer.py` | 3h | âœ… |
| 2.3.2 | é…éŸ³ + BGM + SFX æ··åˆ | `backend/app/workers/audio_mixer.py` | 2h | âœ… |
| 2.3.3 | éŸ³é‡å¹³è¡¡ + æ·¡å…¥æ·¡å‡º | `backend/app/workers/audio_mixer.py` | 2h | âœ… |

### 2.4 API å’Œå‰ç«¯

| ID | ä»»åŠ¡ | æ–‡ä»¶ | å·¥æ—¶ | çŠ¶æ€ |
|----|------|------|------|------|
| 2.4.1 | Dubbing API ç«¯ç‚¹ | `backend/app/api/dubbing.py` | 3h | âœ… |
| 2.4.2 | å‰ç«¯: é…éŸ³æ¨¡å¼é¡µé¢ | `frontend/src/app/dub/[timelineId]/page.tsx` | 6h | âœ… |
| 2.4.3 | å‰ç«¯: éŸ³è‰²é…ç½®é¢æ¿ | `frontend/src/components/Dubbing/VoiceConfig.tsx` | 4h | âœ… |
| 2.4.4 | å‰ç«¯: é…éŸ³é¢„è§ˆæ’­æ”¾å™¨ | `frontend/src/components/Dubbing/DubbedPreview.tsx` | 3h | âœ… |

### éªŒæ”¶æ ‡å‡†

- [x] è§†é¢‘è‡ªåŠ¨åˆ†ç¦»äººå£°/èƒŒæ™¯éŸ³
- [x] å¯å…‹éš†è¯´è¯äººéŸ³è‰²è¿›è¡Œé…éŸ³
- [x] é…éŸ³ä¸åŸè§†é¢‘æ—¶é•¿å¯¹é½ (è¯­é€Ÿè‡ªåŠ¨è°ƒæ•´)
- [x] å¯¼å‡ºå®Œæ•´é…éŸ³è§†é¢‘ (é…éŸ³ + BGM + SFX)

### API ç«¯ç‚¹

```
# é…éŸ³ API
GET    /timelines/{id}/dubbing/config       # è·å–é…éŸ³é…ç½®
PATCH  /timelines/{id}/dubbing/config       # æ›´æ–°é…éŸ³é…ç½®
GET    /timelines/{id}/dubbing/speakers     # è·å–è¯´è¯äººåˆ—è¡¨ + éŸ³è‰²è®¾ç½®
PATCH  /timelines/{id}/dubbing/speakers/{speaker_id}  # æ›´æ–°è¯´è¯äººéŸ³è‰²è®¾ç½®

POST   /timelines/{id}/dubbing/separate     # è§¦å‘éŸ³é¢‘åˆ†ç¦»
POST   /timelines/{id}/dubbing/preview      # é¢„è§ˆå•ä¸ªç‰‡æ®µé…éŸ³
POST   /timelines/{id}/dubbing/generate     # ç”Ÿæˆå®Œæ•´é…éŸ³

GET    /timelines/{id}/dubbing/audio/{type} # è·å–éŸ³é¢‘ (vocals/bgm/sfx/dubbed/mixed)
```

### Pipeline æµç¨‹

```
åŸè§†é¢‘
   â”‚
   â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Audio Separation â”‚  â† Demucs
â”‚ (vocals/bgm/sfx) â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â”‚
         â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Voice Clone    â”‚  â† XTTS v2 / GPT-SoVITS
â”‚  (per speaker)  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â”‚
         â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Audio Mixing   â”‚  â† FFmpeg
â”‚ dubbed+bgm+sfx  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â”‚
         â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Video Export   â”‚
â”‚ (replace audio) â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## Phase 3: å£å‹åŒæ­¥ (å¯é€‰)

> **ç›®æ ‡**: ä½¿ç”¨ Wav2Lip å®ç°é…éŸ³å£å‹åŒæ­¥
> **é¢„ä¼°å·¥æ—¶**: 21h
> **ä¼˜å…ˆçº§**: âšª å¯é€‰/å®éªŒæ€§

### ä»»åŠ¡åˆ—è¡¨

| ID | ä»»åŠ¡ | æ–‡ä»¶ | å·¥æ—¶ | çŠ¶æ€ |
|----|------|------|------|------|
| 3.1 | Wav2Lip ç¯å¢ƒé…ç½® | `requirements.txt` | 3h | â¬œ |
| 3.2 | äººè„¸æ£€æµ‹ + è¿½è¸ª | `backend/app/workers/lip_sync.py` | 4h | â¬œ |
| 3.3 | LipSyncWorker (Wav2Lip) | `backend/app/workers/lip_sync.py` | 6h | â¬œ |
| 3.4 | è§†é¢‘å¸§æ›¿æ¢ + åˆæˆ | `backend/app/workers/lip_sync.py` | 4h | â¬œ |
| 3.5 | å‰ç«¯: å£å‹åŒæ­¥é¢„è§ˆ | `frontend/src/components/Dubbing/LipSyncPreview.tsx` | 4h | â¬œ |

### éªŒæ”¶æ ‡å‡†

- [ ] é…éŸ³è§†é¢‘å£å‹ä¸éŸ³é¢‘åŒæ­¥
- [ ] æ— æ˜æ˜¾ä¼ªå½±/é—ªçƒ
- [ ] æ”¯æŒå¤šäººåœºæ™¯

### æŠ€æœ¯é€‰å‹

| æ–¹æ¡ˆ | ä¼˜ç‚¹ | ç¼ºç‚¹ | æ¨èåœºæ™¯ |
|------|------|------|----------|
| Wav2Lip | æ•ˆæœå¥½ï¼Œé€Ÿåº¦å¿« | éœ€è¦ GPU | é€šç”¨ |
| SadTalker | æ”¯æŒå¤´éƒ¨è¿åŠ¨ | è®¡ç®—é‡å¤§ | å•äººç‰¹å†™ |
| DINet | é«˜æ¸…è¾“å‡º | èµ„æºæ¶ˆè€—é«˜ | é«˜è´¨é‡è¦æ±‚ |

---

## å·¥æ—¶æ±‡æ€»

| Phase | æè¿° | å·¥æ—¶ | ä¼˜å…ˆçº§ | ä¾èµ– | çŠ¶æ€ |
|-------|------|------|--------|------|------|
| **0** | ç»Ÿä¸€åŸºç¡€è®¾æ–½ | 6.5h | ğŸ”´ å¿…é¡» | - | âœ… å®Œæˆ |
| **1B** | å¡ç‰‡ç³»ç»Ÿ | 40h | ğŸ”´ é«˜ | Phase 0 | âœ… å®Œæˆ |
| **1A** | åˆå¹¶ SceneMind | 13h | ğŸŸ¡ ä¸­ | Phase 0 | âœ… å®Œæˆ |
| **1C** | é€æ˜å­—å¹•æ¸²æŸ“ | 8.5h | ğŸŸ¡ ä¸­ | Phase 0 | âœ… å®Œæˆ |
| **1D** | è®°å¿†æœ¬ + Anki | 19h | ğŸŸ¡ ä¸­ | Phase 1B | âœ… å®Œæˆ |
| **2** | é…éŸ³æ¨¡å¼ | 44h | ğŸŸ¢ ä½ | Phase 0 | âœ… å®Œæˆ |
| **3** | å£å‹åŒæ­¥ | 21h | âšª å¯é€‰ | Phase 2 | â¬œ æœªå¼€å§‹ |
| | **æ€»è®¡** | **152h** | | | |

---

## é‡Œç¨‹ç¢‘è§„åˆ’

| é‡Œç¨‹ç¢‘ | åŒ…å« Phase | é¢„è®¡å‘¨æœŸ | äº¤ä»˜ç‰© | çŠ¶æ€ |
|--------|-----------|----------|--------|------|
| **M1** | Phase 0 | 1 å‘¨ | ç»Ÿä¸€æ•°æ®æ¨¡å‹ï¼ŒJob/Timeline æ”¯æŒ mode | âœ… å®Œæˆ |
| **M2** | Phase 1B | 2 å‘¨ | å¯ç‚¹å‡»å­—å¹•ï¼Œå•è¯/å®ä½“å¡ç‰‡å¼¹çª— | âœ… å®Œæˆ |
| **M3** | Phase 1A + 1C | 1.5 å‘¨ | è§‚å½±æ¨¡å¼å®Œæ•´ï¼Œé€æ˜å­—å¹•å¯¼å‡º | âœ… å®Œæˆ |
| **M4** | Phase 1D | 1.5 å‘¨ | è®°å¿†æœ¬åŠŸèƒ½ï¼ŒAnki å¯¼å‡º | âœ… å®Œæˆ |
| **M5** | Phase 2 | 3 å‘¨ | é…éŸ³æ¨¡å¼ MVP | âœ… å®Œæˆ |
| **M6** | Phase 3 | 2 å‘¨ | å£å‹åŒæ­¥ (å®éªŒæ€§) | â¬œ æœªå¼€å§‹ |

---

## é£é™©è¯„ä¼°

| é£é™© | æ¦‚ç‡ | å½±å“ | ç¼“è§£æªæ–½ |
|------|------|------|----------|
| è¯å…¸ API é…é¢/æˆæœ¬è¶…æ”¯ | ä¸­ | é«˜ | æœ¬åœ°ç¼“å­˜ + æ‰¹é‡æŸ¥è¯¢ + å¤‡é€‰å…è´¹ API |
| XTTS v2 GPU æ˜¾å­˜ä¸è¶³ | ä½ | ä¸­ | 16GB æ˜¾å­˜è¶³å¤Ÿ; å„ Worker ä¸²è¡Œæ‰§è¡Œ |
| Wav2Lip æ•ˆæœä¸ç¨³å®š | é«˜ | ä½ | è®¾ä¸ºå¯é€‰åŠŸèƒ½ / æä¾›é¢„è§ˆ / äººå·¥å®¡æ ¸ |
| å®ä½“è¯†åˆ«å‡†ç¡®ç‡ä¸è¶³ | ä¸­ | ä½ | äººå·¥çº é”™ UI / ç”¨æˆ·åé¦ˆæœºåˆ¶ |
| éŸ³è‰²å…‹éš†æ³•å¾‹é£é™© | ä½ | é«˜ | ç›¸ä¼¼åº¦æ§åˆ¶ / æ°´å° / ç”¨æˆ·åè®® |

### GPU æ˜¾å­˜å‚è€ƒ (16GB)

| æ¨¡å‹/Worker | æ˜¾å­˜å ç”¨ | è¯´æ˜ |
|-------------|----------|------|
| Whisper large-v3 | ~4GB | è½¬å½• |
| pyannote.audio | ~2GB | è¯´è¯äººåˆ†ç¦» |
| XTTS v2 | ~4-6GB | éŸ³è‰²å…‹éš† |
| Wav2Lip | ~4GB | å£å‹åŒæ­¥ |
| Demucs | ~2GB | éŸ³é¢‘åˆ†ç¦» |

> æ³¨: å„ Worker ä¸²è¡Œæ‰§è¡Œï¼Œä¸ä¼šåŒæ—¶å ç”¨æ˜¾å­˜ã€‚16GB æ˜¾å¡å®Œå…¨æ»¡è¶³éœ€æ±‚ã€‚

---

## æŠ€æœ¯ä¾èµ–

### Python ä¾èµ– (æ–°å¢)

```txt
# NER
spacy>=3.7.0
en_core_web_lg  # spacy model

# Cards
httpx>=0.25.0   # async HTTP client for APIs

# Dubbing
demucs>=4.0.0   # audio separation
TTS>=0.22.0     # XTTS v2

# Lip Sync (optional)
opencv-python>=4.8.0
mediapipe>=0.10.0

# Anki Export
genanki>=0.13.0
```

### å¤–éƒ¨ API

| API | ç”¨é€” | å…è´¹é¢åº¦ | å¤‡é€‰ |
|-----|------|----------|------|
| Free Dictionary API | å•è¯æŸ¥è¯¢ | æ— é™ | WordsAPI ($10/mo) |
| Wikidata API | å®ä½“ä¿¡æ¯ | æ— é™ | DBpedia |
| OpenAI API | NER (å¯é€‰) | ä»˜è´¹ | spaCy (æœ¬åœ°) |

---

## éªŒæ”¶æ¸…å•

### Phase 0 å®Œæˆæ ‡å‡†
- [x] `JobMode` æšä¸¾å®šä¹‰
- [x] ä¸‰ç§æ¨¡å¼é…ç½®ç±»
- [x] Job API æ”¯æŒ mode å‚æ•°
- [x] å‰ç«¯æ¨¡å¼é€‰æ‹©å™¨
- [x] æ•°æ®è¿ç§»è„šæœ¬
- [x] å•å…ƒæµ‹è¯•é€šè¿‡ (30 tests)

### Phase 1B å®Œæˆæ ‡å‡†
- [x] NER Worker å¯æå–å•è¯å’Œå®ä½“
- [x] å¡ç‰‡ç”Ÿæˆ Worker å¯æŸ¥è¯¢è¯å…¸/Wikidata
- [x] å¡ç‰‡ç¼“å­˜æœºåˆ¶
- [x] å‰ç«¯å¯ç‚¹å‡»å­—å¹•
- [x] å•è¯å¡ç‰‡å¼¹çª— (å‘éŸ³/é‡Šä¹‰/ä¾‹å¥)
- [x] å®ä½“å¡ç‰‡å¼¹çª— (æ‘˜è¦/å›¾ç‰‡/é“¾æ¥)
- [x] TypeScript ç¼–è¯‘é€šè¿‡

### Phase 1A å®Œæˆæ ‡å‡†
- [x] Timeline æ¨¡å‹æ·»åŠ  observations å­—æ®µ
- [x] Timeline API æ”¯æŒ observation CRUD
- [x] FrameCaptureWorker æˆªå›¾åŠŸèƒ½
- [x] å‰ç«¯ types + API å‡½æ•°
- [x] Review é¡µé¢æˆªå›¾åŠŸèƒ½ (å¿«æ·é”® S)
- [x] æ—¶é—´è½´è§‚å¯Ÿç‚¹æ ‡è®°ç»„ä»¶ (ObservationMarkers.tsx)
- [ ] ObservationMarkers é›†æˆåˆ° TimelineEditor (å¯é€‰)
- [ ] æ—§ SceneMind æ•°æ®è¿ç§»è„šæœ¬ (å¯é€‰)

### Phase 1C å®Œæˆæ ‡å‡†
- [x] SubtitleStyleMode æšä¸¾ (half_screen/floating/none)
- [x] ExportWorker æ”¯æŒä¸‰ç§å­—å¹•æ¸²æŸ“æ¨¡å¼
- [x] subtitle_styles.py ASS æ ·å¼ç”Ÿæˆå™¨
- [x] GET/POST /timelines/{id}/subtitle-style-mode API
- [x] å‰ç«¯ types + API å‡½æ•°
- [ ] å‰ç«¯å­—å¹•æ ·å¼é€‰æ‹©å™¨ UI (å¯é€‰)

### Phase 1D å®Œæˆæ ‡å‡†
- [x] è®°å¿†æœ¬ CRUD API
- [x] å¡ç‰‡æ”¶è—åŠŸèƒ½ (CollectButton)
- [x] è®°å¿†æœ¬åˆ—è¡¨é¡µé¢ (/memory-books)
- [x] Anki å¯¼å‡ºåŠŸèƒ½ (AnkiExportWorker)
- [x] å¯¼å‡ºçš„ .apkg å¯æ­£å¸¸å¯¼å…¥ Anki

### Phase 2 å®Œæˆæ ‡å‡†
- [x] éŸ³é¢‘åˆ†ç¦» (vocals/bgm/sfx) - AudioSeparationWorker
- [x] éŸ³è‰²å…‹éš†åŠŸèƒ½ - VoiceCloneWorker (XTTS v2)
- [x] è¯­é€Ÿè‡ªåŠ¨å¯¹é½ - synthesize_segment()
- [x] éŸ³è½¨æ··åˆ - AudioMixerWorker
- [x] é…éŸ³é¢„è§ˆ - /timelines/{id}/dubbing/preview
- [x] å®Œæ•´é…éŸ³è§†é¢‘å¯¼å‡º - /timelines/{id}/dubbing/output

---

*æœ€åæ›´æ–°: 2026-02-03 (Phase 0/1A/1B/1C/1D/2 å·²å®Œæˆï¼Œä»…å‰© Phase 3 å£å‹åŒæ­¥)*
